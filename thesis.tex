% FILE:    thesis_main.tex 
% AUTHOR:  Symon Stowe 
% DATE:    2020-01-06
%--------------------------------------------------------
% !TEX program = lualatex
% !BIB program = biber

% Define style of document
\documentclass[12pt,twoside,notitlepage]{report}
%\documentclass[12pt]{report}
\usepackage{amsmath} 
\usepackage{wasysym}
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{float}
\usepackage{tikz}
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}

% Draw stuff!!!!
\usepackage{tikz}
%\usetikzlibrary{shapes.geometric, arrows}
\usetikzlibrary{arrows,shapes,positioning,shadows,trees}
\tikzset{
  basic/.style  = {draw, text width=5cm, drop shadow, font=\sffamily, rectangle},
  root/.style   = {basic, rounded corners=2pt, thin, align=center,
                   fill=cyan!50},
  level 2/.style = {basic, rounded corners=2pt, thin,align=center, fill=cyan!20,
                   text width=10em},
  level 3/.style = {basic, rounded corners=2pt, thin, align=left, fill=green!15, 
                   text width=8em}
}

% BIBER
\usepackage{csquotes}
\usepackage[american]{babel}
\usepackage[
backend=biber,
style=apa,
giveninits=true,
doi=false,
isbn=false,
url=false,
citestyle=authoryear,
labeldate=year,
maxbibnames=19,
apamaxprtauth=99,
maxcitenames=2,
uniquename=false,
uniquelist=false
]{biblatex}

\AtEveryBibitem{%
  \clearfield{note}%
}

\DeclareLanguageMapping{american}{american-apa}

\renewbibmacro*{name:andothers}{% Based on name:andothers from biblatex.def
  \ifboolexpr{
    test {\ifnumequal{\value{listcount}}{\value{liststop}}}
    and
    test \ifmorenames
  }
    {\ifnumgreater{\value{liststop}}{1}
       {\finalandcomma}
       {}%
     \andothersdelim\bibstring[\emph]{andothers}}
    {}}
\addbibresource{refs.bib}
\newcommand{\citeauthorandyear}[2][]{\citeauthor{#2} (\citeyear[#1]{#2})}
\renewcommand*{\nameyeardelim}{\addcomma\space} % Remove this line if you don't want the comma in citations
\DeclareCiteCommand{\citeyear}
    {}
    {\bibhyperref{\printfield{year}}}
    {\multicitedelim}
    {}

% Shortcuts for the perfusion paper
\newcommand{\PVi}{{\rm P_{Vf}}}
\newcommand{\PAa}{{\rm P_{At}}}
\newcommand{\PAi}{{\rm P_{Af}}}
\newcommand{\PVa}{{\rm P_{Vt}}}
\newcommand{\PBi}{{\rm P_{B}}}
\newcommand{\yB}{\mathbf{y}}
%\newcommand{\vB}{\mathbf{v}}
\newcommand{\uB}{\mathbf{u}}
\newcommand{\xB}{\mathbf{x}}
\newcommand{\xH}{\hat{\mathbf{x}}}
\newcommand{\nB}{\mathbf{n}}
%\newcommand{\CB}{\mathbf{C}}
\newcommand{\FB}{\mathbf{F}}
%\newcommand{\JB}{\mathbf{J}}
\newcommand{\DB}{\mathbf{D}}
\newcommand{\EX}{\mathrm{E}}
\newcommand{\IB}{\mathbf{I}}
\newcommand{\LB}{\mathbf{L}}
\newcommand{\MB}{\mathbf{M}}
\newcommand{\RB}{\mathbf{R}}
\newcommand{\qB}{\mathbf{q}}
\newcommand{\QB}{\mathbf{Q}}
%\newcommand{\VB}{\mathbf{V}}
\newcommand{\WB}{\mathbf{W}}
\newcommand{\sG}{\boldsymbol{\sigma}}
\newcommand{\gG}{\boldsymbol{\gamma}}
\newcommand{\GG}{\boldsymbol{\Gamma}}
\newcommand{\SG}{\boldsymbol{\Sigma}}
\newcommand{\LG}{\boldsymbol{\Lambda}}
\newcommand{\VB}{{\mbox{\bf V}}}
\newcommand{\YB}{{\mbox{\bf Y}}}
\newcommand{\CB}{{\mbox{\bf C}}}
\newcommand{\JB}{{\mbox{\bf J}}} 
\newcommand{\vB}{{\mbox{\bf v}}}

\addto\captionsenglish{% Replace "english" with the language you use
\renewcommand{\contentsname}%
{Table of Contents}% change "Contents" (default) to "Table of Contents"
}

% Define a TODO and Comment
\newcommand{\TODO}[1]{ \textsf{\color{red}{{TODO: #1}}} }
\newcommand{\COMMENT}[1]{ \textsf{\color{blue}{{COMMENT: #1}}} }

\usepackage[section]{placeins}

\usepackage[plain]{fancyref}    
\newcommand*{\fancyrefapplabelprefix}{app}

\fancyrefaddcaptions{english}{%
  \providecommand*{\frefappname}{appendix}%
  \providecommand*{\Frefappname}{Appendix}%
}

\frefformat{plain}{\fancyrefapplabelprefix}{\frefappname\fancyrefdefaultspacing#1}
\Frefformat{plain}{\fancyrefapplabelprefix}{\Frefappname\fancyrefdefaultspacing#1}

% Define margins of document
\sloppy
\usepackage{geometry}
\geometry{verbose,letterpaper} %,tmargin=20mm,bmargin=20mm,lmargin=20mm,rmargin=20mm}
% TODO how to we make the margins alternate like they should be in a book?
% TODO different print vs online versions with different margins?

% Set overall spacing
\usepackage{setspace}
\doublespacing
%\onehalfspacing   

% Shrink list spacing
% shrink the list environments
\usepackage{enumitem}
\setlist{noitemsep}
\setlist{nolistsep}

% Blank pages
\usepackage{afterpage}

\usepackage{verbatim}

\usepackage{amsfonts}
\usepackage{booktabs}
\usepackage{siunitx}

\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    %\addtocounter{page}{-1}%
    \newpage}

%List of abbreviations
\usepackage[acronym,nomain,nonumberlist]{glossaries}
\makeglossaries

\newacronym{ards}{ARDS}{Acute Respiratory Distress Syndrome}
\newacronym{bpm}{bpm}{Beats per Minute}
\newacronym{cmv}{CMV}{Conventional Mechanical Ventilation}
\newacronym{ct}{CT}{Computed Tomography}
\newacronym{ecg}{ECG}{Electrocardiogram}
\newacronym{eit}{EIT}{Electrical Impedance Tomography}
\newacronym{fem}{FEM}{Finite Element Model}
\newacronym{fft}{FFT}{Fast Fourrier Transform}
\newacronym{fwhm}{FWHM}{Full Width Half Max}
\newacronym{gi}{GI}{Global Inhomogeneity}
\newacronym{gui}{GUI}{Graphical User Interface}
\newacronym{icu}{ICU}{Intensive Care Unit}
\newacronym{mri}{MRI}{Magnetic Resonance Imaging}
\newacronym{mse}{MSE}{Mean Squared Error}
\newacronym{peep}{PEEP}{Positive End-Expiratory Pressure}
\newacronym{pet}{PET}{Positron Emission Tomography}
\newacronym{snr}{SNR}{Signal-to-Noise Ratio}
\newacronym{spect}{SPECT}{Single Photon Emission Computed Tomography}
\newacronym{tlv}{TLV}{Total Liquid Ventilation}

% Include packages for manipulating figures/tables
\usepackage{epsfig} 

% Appendix stuff
\usepackage[toc,page]{appendix}

% Different font size in captions
\usepackage{./style/ccaption}
\captionnamefont{\bf \footnotesize}
\captiontitlefont{\footnotesize}
\captionwidth{140mm}
\changecaptionwidth

% Define page numbering scheme
\pagenumbering{roman}

% Make the table of contents clickable
\usepackage{hyperref}

% For the papers in appendix
\usepackage{pdfpages}

\usepackage{fancyvrb}


% Start of document
\begin{document}

% Define aliases
\newcommand{\pbox}{\parbox}

% Figures and Tables
\newtheorem{fig}{Figure}
\newtheorem{tab}{Table}

% Counter commands
\setcounter{page}{1}
\setcounter{chapter}{0}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{3}

% BODY OF TEXT 
% Include the following files in main document
\normalsize

% START OF THESIS
% TITLE PAGE
\include{title/title}
\thispagestyle{empty}
\cleardoublepage

% DEDICATION
\phantomsection
\include{dedication/dedication}
\cleardoublepage

% LIST OF ABBREVIATIONS and SYMBOLS
%\addcontentsline{toc}{chapter}{List of Abbreviations}
%\include{abbrev_body}
%\addcontentsline{toc}{chapter}{List of Symbols}
%\include{symbol_body}
% TODO pageskip TODO maybe!!

% ABSTRACT
\phantomsection
\addcontentsline{toc}{chapter}{Abstract}
\include{abstract/abstract}
\cleardoublepage

% ACKNOWLEDGEMENTS
%\markboth{Acknowledgements}{Acknowledgements}
\phantomsection
\addcontentsline{toc}{chapter}{Acknowledgements}
\include{acknowledgements/acknowledgements}
\cleardoublepage

% CONTENTS, FIGURES, TABLES
\tableofcontents
\addcontentsline{toc}{chapter}{Contents}
%\pagebreak

\markboth{List of Figures}{List of Figures}
\phantomsection
\addcontentsline{toc}{chapter}{List of Figures}
\listoffigures
%\pagebreak

\markboth{List of Tables}{List of Tables}
\phantomsection
\addcontentsline{toc}{chapter}{List of Tables}
\listoftables
%\pagebreak

\markboth{List of Acronyms}{List of Acronyms}
\phantomsection
\addcontentsline{toc}{chapter}{list of Acronyms}
\glsaddall
\printglossary[type=\acronymtype,title=List of Acronyms]
\cleardoublepage
%\pagebreak

% Page Headings
% Chapter headings are in chapter files
\pagestyle{headings}
\pagenumbering{arabic}

% MAIN FILES
\include{chapter1-intro/intro}
\include{chapter2-background/background_I}
\include{chapter2-background/background_II}
\include{chapter3-perfusion_analysis/perfusion_analysis}
\include{chapter4-mesh_refinement/mesh_refinement}
\include{chapter5-CT_to_mesh/CT_to_mesh}
\include{chapter6-internal_electrodes/internal_electrodes}
\include{chapter7-internal_elec_motion/internal_elec_motion}
\include{chapter8-conclusion/conclusion}

% BIBTEX
\phantomsection
\addcontentsline{toc}{chapter}{Bibliography}
%\begin{singlespace}
  \setlength\bibitemsep{5pt}
  \printbibliography
%\end{singlespace}

%\appendix 
\include{chapter9-appendix/appendix}


\end{document}
